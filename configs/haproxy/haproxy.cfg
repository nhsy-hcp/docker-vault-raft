global
    daemon
    maxconn 256
    log stdout format raw local0

resolvers docker-dns
    parse-resolv-conf
    resolve_retries       3
    timeout resolve       1s
    timeout retry         1s
    hold other           30s
    hold refused         30s
    hold nx              30s
    hold timeout         30s
    hold valid           10s
    hold obsolete        30s

defaults
    mode tcp
    log global
    option tcplog
    timeout connect 5s
    timeout client  30s
    timeout server  30s
    default-server resolvers docker-dns

listen stats
    bind *:8080
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if LOCALHOST

frontend vault
    bind *:8200
    mode tcp
    default_backend vault-backend

backend vault-backend
    mode tcp
    balance leastconn
    option httpchk GET /v1/sys/health
    http-check expect rstatus ^(200)$
    server vault-1 vault-1:8200 check check-ssl verify none inter 5s fall 3 rise 2
    server vault-2 vault-2:8200 check check-ssl verify none inter 5s fall 3 rise 2
    server vault-3 vault-3:8200 check check-ssl verify none inter 5s fall 3 rise 2
